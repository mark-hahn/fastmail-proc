
# instructions
- create a project named fastmail-proc at /root/apps/fastmail-proc
  - add git to the project
  - create branch main
  - project git should be kept in github at origin mark-hahn/fastmail-proc
- create the node script src/fastmailProc.js
  - use fastmail jmap api to add/remove labels from messages
  - run once and exit
  - execute jmap api operations based on the file rules.jsonc
    - fastmail api tokens are in secrets/jmapTokens.json
    - load jmapTokens from jmapTokens.json
    - create FASTMAIL_USER constant with default "mark"
    - use jmapTokens[FASTMAIL_USER] for api credential

# the rules.jsonc file
- the top level props of the rules.jsonc file are:
  - "scan-folder":  the folder of the messages to scan
  - "max-messages": the max number of messages to scan before exiting
  - "rule-list":    an array of rules that run on each message
    - rules are executed in order 
    - rules run independently of each other and all are executed
    - a rule is an object specifying a textString, textTests, and possibly ruleActions
    - props for textStrings, textTests, and ruleActions are mixed together in the rule object
      - the textString is generated by props in a rule
      - the textString is a concatenation of text values separated by | pipes
      - each of these props below give a text value
        - "header": value of a header with this name
        - "from":   when true the value is the `from` email address
        - "to":     when true the value is the `to`   email address
        - "subject" when true the value is message subject
        - "body" is when true the value is message body text

      - the textTests is generated by props of a rule
      - the textTests is that all existing prop conditions below are true
        - "empty"     when true the condition is the textString is empty
        - "not-empty" when true the condition is the textString is not empty
        - "exact"     value is an exact match for all of the text
        - "not-exact" value is not an exact match for all of the text
        - "regex"     value is an unescaped regex pattern that matches the textString
        - "contains"  value is a substring of the text
        - "one-of"    value is an array of strings
          - condition is that one of the string entries is a substring of the textString

      - any ruleAction prop is executed when the textTests passes
        - "add-label"    add a label with this name to the message
        - "remove-label" remove any label with this name from the message
        - "stop" stop processing rules
# notes
- the term folder means a set of messages labeled with the folder's name
  - same as gmail
- all matching is case-insensitive
- ignore all files in misc folder
- send stdout and stderr to jmap-proc.log and terminal

